# メモ

### scheduling.md
- ジョブショップ・スケジューリング問題の文。
- 出力形式が気持ち悪いが支障はない

### vis.html
- ビジュアライザ。
- 1がベースで、2がライトモード。3で整数での評価に修正

### greedy.py
- 貪欲法で解く
- 開始時刻、終了時刻。ジョブIDの順で優先度を決める
- ビジュアライザの貪欲法と同じ挙動だと思う
- sum_score: 366255

### beam.py
- ビームサーチ
- 何気に通常のビームサーチは初めて実装するかも
- なんかスコアが悪化している
- 評価関数にミスがあった
- CPythonで105.538秒, 113.058秒
- 時短のためPyPyで実行
  - 結果が変わることはないはず
- これjob_queueを毎回コピーしているから計算量に問題がある気がする
- 一旦やり直しかな
- 実行時間が3.4秒になった
- ただ出力がされない
  - 空行が21個
- job_queueの取得を忘れていた
- 今度は再帰の深さが足りない
- 0000実行したら貪欲と同じ結果
  - 想定外
  - このときK=30
- とりあえず60秒付近までビーム幅を引き上げよう
- K=300
  - 結果が貪欲法と同じ
- 何か間違っているのか
- sum_score: 365948
- 若干の差はあるらしい
- 改善されているのはされている
- PyPyで実行時間を計測
- 0000-0004の実行時間
```
18.2
18.8
18.3
18.1
18.9
```
- 平均18.46秒
- ~~chokudaiサーチの制限時間を18.5秒にしようか~~
  - 時間ではなくビーム本数で制御しよう
  - 普段はやらないけど、比較できるように

### chokudai.py
- chokudaiサーチ
- ビームの回数で制御
- 300回
  - メモリ使用量が20GBを超えそうなので中断
- 100で8.2GB
- 100を並列無しで実行
- sum_score: 366255
- 貪欲法と同じ
- 評価関数が悪いのかな

## 2の方針
- 試したところ、貪欲法と結果に差が見られないみたいなことをchokudaiさんが書いていた気がする
- ビジュアライザでgemini出した複雑な評価関数をやめる
- その時点での $C_{\max}$ をそのまま評価値とする

### greedy2.py
- 評価値を変える
- sum_score: 407588

### beam2.py
- 同様に、評価値を変える
- ~~sum_score: 407245~~
- K=300のままだった
- 100に変更
- sum_score: 407192
- 上がった!?

### chokudai2.py
- 同じく評価値を変える
- 相変わらず凄まじい量のメモリを食う
- sum_score: 407588
- そんな変わらないことあるか
- なんか間違っているのでは

## わかった気がする
- ジョブ数が多いと貪欲に埋めても普通に良い結果が出る
- 空白が発生しにくい?
- ハイパーパラメーターを調整しよう
- あとchokudai_listの手番ごとの配列は優先度付きキューのほうがいいね
  - ビーム本数を $K$、1回の探索で新たに訪問するノードの数を $N$ とすると、1探索の計算量が $O(KN \log{KN})$ から $O(\log{KN})$ になると思う
    - 多分そう
  - この変更は面倒だが必須
  - 今日のAHCでも使えるかもしれないからやろう
- beam3とchokudai3を作成する
- 意外と評価値関数を持ちながら優先度付きキューを使うのは大変
- ~~ToDo: beam3の評価値に乱数かなんかつける~~
  - 中止

## 上記の「今日のAHC」で得たこと
- chokudaiサーチを実装した
- `__lt__`メソッドで比較ができることを知った
- 今までの方法は普通にメモリ消費量が多い
- 手の復元のところだけ別で管理したらいいのでは
- そこそこの変更が必要になる
- それを踏まえてbeam3とchokudai3を作成する

### 作成
- やはりスコアが悪化する謎現象
- 新しいテストケースでのやつは余力があれば後でやる
  - 結局翌日に回した
- というわけで新しいテストケースを考える

### in2/
- J=20, M=80
#### greedy2-2
- sum_score: 533969
#### beam3-2
- 幅100
- 7秒前後
- sum_score: 533430
- なんとも微妙
- これ評価関数は前のほうが良かったかな
#### chokudai3-2
- 100本
- 9秒前後
- メモリ使用量も3GB強
  - ガベージコレクションは偉大
- sum_score: 533969
  - またgreedyと一緒
  - そんなことあるか?
- 実装の方に問題があるのでは
- 問題が見つかった
- heappopしてなかった
- そりゃ貪欲法と同じ結果になる
- やり直し
- 今回はメモリ使用量が4GBを超えたりしている
- 3つ並列で実行
- 10-11秒
- なんかおかしいな
  - 途中でCtrl+C押したっけ
- sum_score: 533603
- 改善はしたけれど、ビームサーチのほうがスコアがいい
- それは困った